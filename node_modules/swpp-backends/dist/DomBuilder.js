"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildDomJs = void 0;
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const Utils_1 = require("./Utils");
const Variant_1 = require("./Variant");
/**
 * 构建 DOM 端的 JS 文件
 *
 * + **执行该函数前必须调用过 [loadRules]**
 */
function buildDomJs() {
    const config = (0, Variant_1.readRules)().config.dom;
    if (!config) {
        (0, Utils_1.error)('DomJsBuilder', '该配置项未开启');
        throw '功能未开启';
    }
    let template = fs_1.default.readFileSync(path_1.default.resolve('./', module.path, 'resources/sw-dom.js'), 'utf-8');
    const key = 'const {onSuccess} = require(\'../config\')';
    if (config.onsuccess) {
        template = template.replaceAll(key, `const onSuccess = ${config.onsuccess.toString()};`);
    }
    else {
        template = template.replaceAll(key, 'const onSuccess = () => {}');
    }
    return template;
}
exports.buildDomJs = buildDomJs;
